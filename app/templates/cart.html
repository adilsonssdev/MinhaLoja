{% extends "base.html" %}

{% block title %}
Cart - MiniLoja
{% endblock %}

{% block content %}
<div class="py-5">
	<h2 class="mb-4 fw-bold">Shopping Cart</h2>

	<!-- Alerts -->
	{% with msgs = get_flashed_messages(with_categories=True) %}
	{% if msgs %}
	{% for c, msg in msgs %}
	<div class="alert alert-{{ 'danger' if c == 'error' else 'success' }} alert-dismissible fade show" role="alert">
		{{ msg | safe }}
		<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
	</div>
	{% endfor %}
	{% endif %}
	{% endwith %}

	{% if not items %}
	<div class="text-center py-5 bg-white rounded-3 shadow-sm">
		<i class="fa fa-shopping-basket fa-3x text-muted mb-3"></i>
		<h3>Your cart is empty</h3>
		<p class="text-muted">Looks like you haven't added anything to your cart yet.</p>
		<a href="{{ url_for('home') }}" class="btn btn-primary mt-2">Start Shopping</a>
	</div>
	{% else %}
	<div class="row g-4">
		<!-- Cart Items -->
		<div class="col-lg-8">
			<div class="bg-white rounded-3 shadow-sm p-4">
				<div class="table-responsive">
					<table class="table table-borderless align-middle">
						<thead class="border-bottom">
							<tr class="text-uppercase text-secondary small">
								<th scope="col">Product</th>
								<th scope="col" class="text-center">Price</th>
								<th scope="col" class="text-center">Quantity</th>
								<th scope="col" class="text-end">Total</th>
								<th scope="col"></th>
							</tr>
						</thead>
						<tbody>
							{% for i in range(items|length) %}
							<tr class="border-bottom">
								<td>
									<div class="d-flex align-items-center">
										<img src="{{ items[i].image }}" alt="{{ items[i].name }}" class="rounded"
											style="width: 60px; height: 60px; object-fit: contain;">
										<div class="ms-3">
											<h6 class="mb-0 fw-bold">{{ items[i].name }}</h6>
										</div>
									</div>
								</td>
								<td class="text-center">${{ items[i].price }}</td>
								<td class="text-center">{{ quantity[i] }}</td>
								<td class="text-end fw-bold">${{ quantity[i]*items[i].price }}</td>
								<td class="text-end">
									<a href="{{ url_for('remove', id=items[i].id, quantity=quantity[i]) }}"
										class="text-danger" title="Remove">
										<i class="fa fa-trash"></i>
									</a>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
				<div class="mt-3">
					<a href="{{ url_for('home') }}" class="text-decoration-none"><i
							class="fa fa-arrow-left me-2"></i>Continue Shopping</a>
				</div>
			</div>
		</div>

		<!-- Order Summary -->
		<div class="col-lg-4">
			<div class="bg-white rounded-3 shadow-sm p-4">
				<h5 class="fw-bold mb-4">Order Summary</h5>
				<div class="d-flex justify-content-between mb-2">
					<span class="text-muted">Subtotal</span>
					<span class="fw-bold">${{ price }}</span>
				</div>
				<div class="d-flex justify-content-between mb-3">
					<span class="text-muted">Shipping</span>
					<span class="text-success">Free</span>
				</div>
				<hr>
				<div class="d-flex justify-content-between mb-4">
					<span class="fw-bold fs-5">Total</span>
					<span class="fw-bold fs-5 text-primary">${{ price }}</span>
				</div>

				<form method="POST" action="{{ url_for('create_checkout_session') }}">
					<input type="hidden" value="{{ price_ids }}" name="price_ids">
					<button class="btn btn-primary w-100 py-2 fw-bold shadow-sm">Proceed to Checkout</button>
				</form>

				<div class="mt-3 text-center">
					<small class="text-muted"><i class="fa fa-lock me-1"></i> Secure Checkout</small>
				</div>
			</div>
		</div>
	</div>
	{% endif %}
</div>
{% endblock %}